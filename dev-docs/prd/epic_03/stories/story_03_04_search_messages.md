# Story 03-04: 查找聊天记录功能

> Epic: 聊天详情抽屉菜单  
> Priority: Medium  
> Points: 5

## 概述
在抽屉菜单中点击"查找聊天记录"后，用户可以输入关键词搜索与当前好友的所有历史消息（包括归档会话）。搜索结果按时间倒序排列，显示匹配数量和上下文预览。点击某条结果后，抽屉自动关闭，聊天区域能够定位并高亮显示该消息。这让用户能够快速找到特定的对话内容。

## 用户故事

### US-1: 搜索历史消息
**作为** 用户，  
**我希望** 能够输入关键词搜索与当前好友的聊天记录，  
**以便** 快速找到我想回顾的对话内容。

### US-2: 浏览搜索结果
**作为** 用户，  
**我希望** 看到包含关键词的消息列表和上下文预览，  
**以便** 判断哪条结果是我需要的。

### US-3: 定位到原始消息
**作为** 用户，  
**我希望** 点击搜索结果后能够跳转到聊天区域的对应位置，  
**以便** 查看完整的上下文对话。

## 功能范围

### 包含
- "查找聊天记录"菜单项的点击交互
- 搜索输入框和搜索按钮（支持回车键触发）
- 关键词搜索逻辑（搜索范围：当前好友所有会话的消息）
- 搜索结果列表展示（消息片段 + 时间 + 发送者 + 关键词高亮）
- 搜索结果数量显示（如"找到 15 条结果"）
- 点击搜索结果后，**抽屉自动关闭**，定位到 `ChatArea` 对应消息
- 空搜索结果提示
- Loading 状态和网络错误处理

### 不包含（后续迭代）
- 高级搜索（按时间范围、消息类型筛选）
- 搜索历史记录保存
- 正则表达式搜索
- 全局搜索（跨好友）

## 验收标准

- [ ] AC-1: 点击"查找聊天记录"菜单项后，抽屉内容区切换为搜索视图，顶部显示返回按钮和搜索输入框
- [ ] AC-2: 搜索输入框自动获得焦点，支持回车键触发搜索
- [ ] AC-3: 搜索范围为与当前好友的所有历史消息（包括当前会话和归档会话）
- [ ] AC-4: 搜索触发后显示 Loading 状态，搜索完成后显示结果数量（如"找到 15 条结果"）
- [ ] AC-5: 搜索结果按时间倒序排列，每条结果显示消息片段（前后各 30 字符）、时间、发送者（用户或 AI）
- [ ] AC-6: 搜索结果中的关键词高亮显示
- [ ] AC-7: 点击某条搜索结果后，**抽屉自动关闭**，`ChatArea` 自动滚动到该消息位置并高亮显示 3 秒
- [ ] AC-8: 如果没有找到匹配结果，显示"未找到相关聊天记录"提示
- [ ] AC-9: 搜索失败时显示错误提示和重试按钮

## 依赖关系

### 前置依赖
- Story 03-01: 基础抽屉组件和菜单框架
- Epic-01: 核心聊天功能（消息 API）

### 被依赖（后续）
- 无直接被依赖

## 备注
- 后端 `/api/messages/search` 接口需要支持按 `friend_id` 和 `keyword` 参数查询，搜索范围包括所有会话
- 前端需要实现 `ChatArea` 滚动定位和消息高亮的逻辑（高亮 3 秒后自动消失）
- 消息片段进行长度限制（如前后各 30 个字符），关键词前后保留完整词语边界
- 搜索结果点击后需要先加载对应会话的消息，再滚动定位
