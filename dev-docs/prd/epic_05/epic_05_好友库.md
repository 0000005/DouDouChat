# Epic 05: 好友库 (Friend Gallery)

## Epic 信息
- **Epic 编号**: Epic-05
- **Epic 名称**: 好友库 (Friend Gallery)
- **创建日期**: 2026-01-08
- **优先级**: High

## 业务目标

这个 Epic 旨在通过预设的人格仓库，让用户能够更快速、更直观地发现和添加感兴趣的 AI 好友。

1. **降低门槛**：解决用户不知如何配置人格设定的痛点，提供现成的优质人格模板。
2. **场景引导**：通过分类引导用户探索 AI 的多样化应用场景（职场、情感、娱乐等）。
3. **社交模拟**：模拟真实社交软件中"添加联系人"的发现机制，增强产品的社交沙盒感。

## 成功指标

| 指标 | 定义 | 目标值 |
|------|------|--------|
| 好友库打开率 | 点击"好友库"入口的用户 / 看到入口的用户 | ≥ 30% |
| 模板添加转化率 | 成功添加预置好友的用户 / 打开好友库的用户 | ≥ 50% |
| 模板好友 7 日活跃 | 通过好友库添加的好友在 7 天内有对话的比例 | ≥ 40% |

## 范围描述

### 包含内容
- **双入口设计**：
  - **IconSidebar 图标入口**：在左侧图标栏（聊天图标下方）新增"好友库"图标，点击切换到好友库页面。
  - **Sidebar 下拉菜单入口**：侧边栏左上角"新增好友"按钮重构为下拉菜单，包含"手动创建"和"好友库"两个选项。
- **好友库页面**：在原聊天内容区域（chat-container）展示好友库，提供沉浸式的浏览体验（非弹窗，是完整页面切换）。
- **搜索与筛选**：支持按关键词搜索好友，支持按分类标签多维度筛选。
- **详情预览**：支持查看预置好友的精美介绍、标签、以及人格设定（可折叠展开）。
- **一键添加**：点击添加后，将该人格模板实例化为用户的私有好友，并自动跳转至对话界面。
- **AI 辅助创建（找不到想要的好友时）**：当用户搜索无果或想创建库中不存在的人物时，引导进入对话式创建流程，通过简单描述（如"我想创建刘亦菲"），LLM 自动生成专业的人格设定，零门槛完成好友创建。

### 不包含内容
- **社区化投稿**：暂不支持用户自行投稿好友到全局库（初期仅限官方预置）。
- **好友评价系统**：本阶段暂不实现针对预设人格的评分或评论功能。
- **模板编辑**：添加后的好友继承模板设定，暂不支持基于模板的二次编辑。

## 用户旅程

### 路径 A：从好友库添加预置好友
```
用户点击 IconSidebar 中的"好友库"图标（或通过 Sidebar 下拉菜单选择"好友库"）
→ 主内容区切换至好友库展示页面（在原聊天区域位置展示）
→ 浏览分类标签栏和卡片网格 
→ 点击感兴趣的好友卡片 → 展开详情预览面板 
→ 阅读人格简介，可选展开查看完整人格设定 
→ 点击"添加为好友" → 自动跳转至该好友聊天界面，IconSidebar 切换回聊天 Tab
```

### 路径 B：AI 辅助创建自定义好友
```
用户在好友库中搜索"刘亦菲" → 未找到匹配结果 
→ 空状态页显示"找不到？让 AI 帮你创建" 按钮 → 点击进入创建向导 
→ AI 引导对话："请描述这个人物的特征"（用户输入简单描述） 
→ AI 确认关键信息（性别、职业、性格、说话风格等） 
→ 后台调用 LLM 生成完整人格设定（System Prompt） 
→ 预览生成的好友卡片 → 用户确认后添加至好友列表 → 跳转至对话界面
```

## 分类定义

好友库的核心定位是 **"和名人对话"** 的沉浸式角色扮演体验。所有预置人格都是有辨识度的真实人物或经典 IP，而非泛化的"助手"角色。

采用**标签式分类**，一个人物可属于多个标签。初始标签列表：

| 分类标签 | 定位 | 示例人格 |
|----------|------|----------|
| 🚀 商业领袖 | 和顶级企业家聊商业、创业、人生哲学 | 埃隆·马斯克、雷军、张一鸣、乔布斯 |
| 💻 科技大咖 | 和产品/技术大神聊产品思维、技术趋势 | 张小龙、俞军、Linus Torvalds、Sam Altman |
| ⚖️ 知识名人 | 和各领域的"网红教授"们深度交流 | 罗翔（法律）、戴建业（文学）、李永乐（科学） |
| 📖 文人墨客 | 和历史上的文学巨匠对话，感受思想碰撞 | 鲁迅、王小波、苏轼、海明威 |
| 🏛️ 历史风云 | 穿越时空，与帝王将相、谋士名将对弈 | 诸葛亮、曹操、拿破仑、成吉思汗 |
| 🎬 影视经典 | 和你最爱的影视剧角色继续未完的故事 | 甄嬛、令狐冲、小丑(Joker)、钢铁侠 |
| 🎮 二次元 | 游戏/动漫角色走进现实，成为你的好友 | 雷电将军、钟离、2B、初音未来 |
| 🎤 娱乐明星 | 和你喜欢的明星聊音乐、电影、生活 | 周杰伦、Taylor Swift、刘德华 |

## 边界与异常处理

| 场景 | 处理方式 |
|------|----------|
| 搜索无结果 | 显示空状态插图 + 文案"没有找到匹配的好友，试试让 AI 帮你创建？" + CTA 按钮 |
| 好友库为空 | 显示"好友库正在建设中，敬请期待" |
| 重复添加同一模板 | 允许多次克隆，每次生成独立的好友实例（支持用户创建多个同模板好友） |
| AI 创建时用户描述不清 | AI 引导追问："能再详细描述一下TA的性格或职业吗？" |
| LLM 生成失败 | 显示"AI 助手暂时开小差了，请稍后重试"，保留用户输入，可重新生成 |
| 用户取消创建流程 | 自动保存草稿，下次进入可选择继续或重新开始 |
| 网络异常 | 显示 Toast 提示"网络开小差了，请稍后重试" |
| 添加失败 | 弹窗内显示错误提示，保留当前状态，用户可重试 |

## Story 拆分建议

| Story | 描述 | 优先级 |
|-------|------|--------|
| Story 05-01 | IconSidebar 新增好友库图标入口 + Sidebar 下拉菜单重构（双入口）| High |
| Story 05-02 | 好友库页面基础 UI：分类标签栏、响应式卡片网格布局（在聊天区域展示）| High |
| Story 05-03 | 好友搜索与分类过滤逻辑（前端交互 + 后端接口） | High |
| Story 05-04 | 好友详情预览页：Markdown 简介 + 人格设定折叠展示 | Medium |
| Story 05-05 | 好友添加逻辑：从模板克隆至用户私有好友列表并跳转 | High |
| Story 05-06 | 后端数据层：模板表设计、初始 Seed 数据、API 实现 | High |
| Story 05-07 | 角色创建方法论 + 批量预置好友生成（每分类 20 个，共 160 个）| High |
| Story 05-08 | AI 辅助创建向导：对话式引导 + LLM 生成人格设定 + 预览确认（复用 05-07 API）| High |

### Story 依赖说明

```
Story 05-07 (方法论 + 批量生成)
    │
    ├── 输出：角色创建 Prompt 模板 + 人格生成 API (/api/personas/generate)
    │
    └── 被复用于 ──→ Story 05-08 (用户自助 AI 创建向导)
```

**Story 05-07 核心内容**：
1. **提炼方法论**：总结一套结构化的角色 Prompt 设计框架，包括：
   - 人物背景（身份、职业、时代背景）
   - 性格特征（MBTI/九型人格风格参考）
   - 说话风格（语气、口头禅、表达习惯）
   - 知识边界（擅长领域、认知局限）
   - 情感模式（如何回应情绪、建立亲密感）
2. **人格生成 API**：基于方法论封装 LLM 调用，输入人名或简单描述，输出完整人格设定
3. **批量生成 160 个预置好友**：为 8 个分类各生成 20 个高质量模板人格

## 技术约束

- **页面架构**：好友库作为独立页面组件 `FriendGallery.vue`，通过 `activeTab` 状态切换显示（与 ChatArea 互斥）。
- **IconSidebar 扩展**：在 `navItems` 中新增 `{ id: 'gallery', icon: Users, label: '好友库' }` 项。
- **UI 组件**：使用 `DropdownMenu` 实现 Sidebar 入口切换，页面内使用 `Tabs` + `Card` 布局。
- **数据模型**：
  - 扩展现有 `personas` 表，新增 `is_template` (Boolean) 和 `template_tags` (JSON Array) 字段。
  - 用户添加时，克隆模板记录并设置 `is_template = false`，保留 `source_template_id` 用于追踪来源。
- **人格设定展示**：默认折叠，点击"查看完整设定"展开，避免信息过载。

## 依赖关系

### 前置依赖
- **Epic-01**: 基础聊天界面（`personas` 表结构已就绪）
- **Epic-03**: 会话管理机制（添加好友后需创建会话）

### 后续 Epic
- **Epic-06**: 用户自定义人格分享社区（基于本 Epic 的模板机制扩展）
