# Story 08-04: AI 消息“重新回答”逻辑

> Epic: 消息气泡交互与快捷操作增强
> Priority: Medium
> Points: 5

## 概述
允许用户要求 AI 重新生成回复。这会删除旧有的 AI 回复消息组，并重新触发流式生成。

## 用户故事

### US-1: 获取更好回答
**作为** 用户，
**我希望** 能让 AI 重新回答我的上一个问题，
**以便** 在对当前回答不满意时尝试获取更好的结果。

## 功能范围

### 包含
- AI 消息菜单中显示“重新回答”选项。
- **业务规则校验**：仅在会话处于“未归档”状态时允许重新回答。
- 触发“重新回答”后，前端清除当前 AI 回复的所有气泡（逻辑消息组）。
- 调用后端接口重新触发对话生成（使用相同的 User 上下文）。
- 处理新的流式响应并渲染。
- **异常处理**：若重新生成请求失败，应恢复显示旧的 AI 回复并提示错误。

### 不包含（后续迭代）
- 保留历史回答版本供切换（目前是覆盖式重做）。

## 验收标准

- [ ] AC-1: 仅 AI 发送的消息（Role=Assistant）显示“重新回答”菜单项。
- [ ] AC-2: 若当前会话已归档，不显示“重新回答”选项。
- [ ] AC-3: 点击“重新回答”后，旧的 AI 回复气泡从 UI 上临时移除/隐藏，进入流式生成状态。
- [ ] AC-4: UI 上应立即显示“对方正在输入...”或新的流式生成动画。
- [ ] AC-5: 对于多气泡的 AI 回复，在任意一个气泡上点击“重新回答”都应作用于整个消息组。
- [ ] AC-6: 若重新生成失败（如网络错误），系统应自动恢复显示旧的 AI 回复消息，并显示错误提示 Toast。

## 依赖关系

### 前置依赖
- Story 08-01: 菜单基础结构。
- Story 01_01: 流式消息处理能力。

### 被依赖（后续）
- 无
