# Story 08-03: 用户消息“撤回”功能及会话状态校验逻辑

> Epic: 消息气泡交互与快捷操作增强
> Priority: High
> Points: 5

## 概述
允许用户撤回自己发送的消息。撤回操作需要校验会话状态（未归档），并会级联删除 AI 对该消息的回复。

## 用户故事

### US-1: 撤回错误消息
**作为** 用户，
**我希望** 能撤回刚才发出的错误消息，
**以便** 修正对话上下文，避免 AI 基于错误信息继续生成。

### US-2: 归档会话禁止撤回
**作为** 用户，
**我希望** 在查看历史归档会话时不能撤回消息，
**以便** 保持历史记录的完整性和真实性。

## 功能范围

### 包含
- 用户消息菜单中显示“撤回”选项。
- 撤回的业务规则校验：仅“未归档”会话的消息可撤回。
- **二次确认机制**：点击“撤回”后弹出确认对话框，防止误触。
- 撤回API调用及通过SSE或前端逻辑处理级联删除（删除 User 消息 + 对应的 AI 回复）。
- UI 更新：用户消息变为“你撤回了一条消息”提示，AI 回复气泡移除。

### 不包含（后续迭代）
- 超过一定时间（如2分钟）禁止撤回的规则（目前仅基于会话状态）。
- 撤回内容的重新编辑（Re-edit）。

## 验收标准

- [ ] AC-1: 仅用户发送的消息（Role=User）显示“撤回”菜单项。
- [ ] AC-2: 如果当前会话已归档，则不显示“撤回”选项，或点击后提示不可撤回。
- [ ] AC-3: 点击“撤回”后显示二次确认弹窗（“确定要撤回这条消息吗？”），确认后执行撤回。
- [ ] AC-4: 撤回成功后，该消息气泡被替换为“你撤回了一条消息”的系统提示。
- [ ] AC-5: 撤回用户消息时，系统应自动检查并删除该消息引发的 AI 回复（如果存在）。
- [ ] AC-6: 撤回操作应同步到后端持久化存储。

## 依赖关系

### 前置依赖
- Story 08-01: 菜单基础结构。
- 后端支持级联删除的 API。

### 被依赖（后续）
- 无
