# Story 09-04: @提及功能与强制触发

> Epic: AI 多人群聊 (Group Chat)
> Priority: High
> Points: 5

## 概述
实现群聊中的核心交互功能——@ 提及。前端需提供智能联想菜单，后端需解析消息中的提及信息，并以此作为强制调度 Agent 发言的依据，确保对话的定向性和灵活性。

## 用户故事

### US-1: @ 联想与输入
**作为** 用户，
**我希望** 在群聊输入框输入 "@" 时能看到成员列表并快速选择，
**以便** 准确呼叫指定的 AI 进行对话。

### US-2: 定向强制发言
**作为** 用户，
**我希望** 被我 @ 到的 Agent 即使在非自动回复模式下也会回复我，
**以便** 实现针对性的互动和指令传达。

## 功能范围

### 包含
- **前端 @ 菜单**: 监听键盘输入，当光标位置输入 "@" 时弹出成员选择浮窗（含头像与群昵称）。
- **消息本体封装**: 发送消息时，除了文本外需携带 `mentions` 字段（包含被提到成员的 ID 列表）。
- **后端提及解析**: 后端接收消息后校验 `mentions`，将其优先级设为最高。
- **多目标并发调度**: 支持一次消息中 @ 多个成员，并触发后端并行的 Agent 任务。

### 不包含（后续迭代）
- "@所有人" 的全局提醒逻辑
- 仅有 @ 动作而无后续文字的空白消息处理
- 复杂的 @ 颜色高亮（初期以普通文案展示）

## 验收标准

- [ ] AC-1: 在输入框输入 "@" 成功激活联想菜单，支持键盘上下箭头交互和 Enter 选择。
- [ ] AC-2: 后端接口能正确解析并接收到消息中的被提及者 ID 列表。
- [ ] AC-3: 若消息中存在 @ 目标，后端逻辑必须无视 `auto_reply` 配置，强制拉起对应 Agent 生成回复。
- [ ] AC-4: 用户能够通过 @ 功能一次性“钓出”多个 Agent 并看到他们同时进入思考状态。
- [ ] AC-5: @ 菜单的 UI 样式符合微信规范（背景色、悬浮状态、弹出动画）。

## 依赖关系

### 前置依赖
- Story 09-03: 群组管理界面开发 (UI)
- Story 09-05: 群聊消息服务接口 (API & SSE)

### 被依赖（后续）
- Story 09-08: 隐藏的群管理员 Agent 实现
