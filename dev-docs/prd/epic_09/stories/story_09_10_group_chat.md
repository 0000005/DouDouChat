# Story 09-10: 群聊输入状态展示优化

## 背景
目前，在群聊界面中，当任何 AI 或用户处于活跃生成状态时，顶部标题栏会显示通用的“对方正在输入...”提示。这在多 Agent 群聊场景中并不理想，因为用户更希望清楚地知道*具体是谁*准备发言。

## 目标
通过以下方式提升群聊的用户体验：
1.  移除窗口标题栏中全局通用的输入提示。
2.  在聊天区域（右下角，输入框上方）添加具备上下文感知能力的输入提示，明确指出当前正在生成回复的 Agent 名称。

## 需求详情

### 1. 后端：发送发言者身份
后端必须尽可能早地通知前端哪些 Agent 被选中参与回复。

-   **修改文件**: `server/app/services/group_chat_service.py`
-   **逻辑**:
    -   在 `send_group_message_stream` 方法中，当群管理员（Group Manager）或显式提及（@mention）逻辑确定了 `participants` 列表后，在启动生成任务*之前*，发送一个新的 SSE 事件（例如 `meta_participants`）。
    -   **事件负载 (Payload)**: 应包含被选中的 Agent ID 和名称列表。
    -   **事件发送规则**: 只发送一次，且该列表在首次发送时即为最终发言人列表，后续不会追加或更改。
    -   **事件顺序约束**: `meta_participants` 必须发生在该轮次任何 `thinking`/`message`/`tool_*` 事件之前（允许晚于 `start` 事件）。
    -   **事件负载 (Payload) 必含字段**: `group_id`、`session_id`、`participants`（数组，元素包含 `id`、`name`）。
    -   示例: `{"event": "meta_participants", "data": {"group_id": 101, "session_id": "s_abc", "participants": [{"id": 1, "name": "艾萨克·牛顿"}, {"id": 2, "name": "孔丘"}]}}`
    -   **类型同步**: 若前后端有统一的 SSE 事件类型枚举/白名单，需要同步添加 `meta_participants` 类型。

### 2. 前端：Store 状态与逻辑
前端的 Session Store 需要捕获并维护这个“即将发言者”列表。

-   **修改文件**: `front/src/stores/session.ts`
-   **逻辑**:
    -   在 `sendGroupMessage` 处理函数中，增加对 `meta_participants` 事件的处理。
    -   在 Store 中更新一个新的响应式状态 `groupTypingUsers`（字符串数组）。
    -   **清除策略**: 每个发言者完成时，清除该发言者的等待状态；直到所有发言者都清除完毕后，提示消失。
    -   **消息绑定**: 通过 `group_id` / `session_id` 绑定当前会话，避免串流更新到错误会话。
    -   **完成判定**: 以该发言者的 `done` 或 `error` 事件作为完成信号（基于 `sender_id` 进行移除），需幂等处理以避免重复移除报错。

### 3. 前端：UI 更新
-   **修改文件**: `front/src/components/ChatArea.vue`（或 `GroupChatArea.vue`，视具体实现而定）。
    -   **移除**: 群聊模式下顶部标题栏显示“正在输入...”的逻辑。
    -   **新增**: 在聊天消息列表的底部右侧（悬浮或固定在输入框上方）添加一个新的 UI 元素。
    -   **内容**: 展示为 “XXX、XXX 正在输入中...”。
    -   **名称规则**: 使用后端返回的 `name` 字段展示；后端保证合法发言人列表（无需处理 @mention 失败或离线情况）。
    -   **显示时机**: 当 `groupTypingUsers` 为空时不显示该提示。
    -   **作用范围**: 仅群聊模式显示，单聊不受影响。
    -   **样式**:
        -   设计风格需细腻，可包含微小的动画效果（如动态省略号）。
        -   居右对齐，以匹配用户对输入区域的焦点。
        -   能够处理单个或多个名称（使用顿号分隔）。
        -   名称过长时可截断并省略，避免遮挡输入框或发送按钮。

## 验收标准 (AC)
1.  **群聊标题**: 在 AI 生成期间，顶部标题不应显示“对方正在输入...”。
2.  **输入提示**:
    -   当用户发送消息且管理员决定由谁发言后，UI 底部应显示 “Agent名称 正在输入中...”。
    -   如果选中了多个 Agent，应显示 “AgentA、AgentB 正在输入中...”。
    -   任一发言者完成或报错后，该发言者应从提示中移除；当全部完成后提示消失。
3.  **时效性**: 名称应在后端选定发言人后立即出现，即使“心路历程 (Thinking)”内容尚未开始传输。（这就是为什么需要在选定后立即发送 `meta_participants` 消息的原因）。

## 技术细节
-   `GroupManager` 可能需要几秒钟来“思考”由谁发言。在这一阶段，我们可能还不知道确切的发言人。输入提示将在 Manager 做出决策后、Agent 正式开始生成正文前出现。
-   如果用户使用了 @mention 提及了特定的好友，参与者列表是立即可知的，该事件应立即下发。
