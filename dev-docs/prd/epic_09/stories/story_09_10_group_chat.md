# Story 09-10: 群聊定向记忆提取

> Epic: AI 多人群聊 (Group Chat)
> Priority: Medium
> Points: 5

## 概述
实现针对群聊场景的记忆归档与提取逻辑。由于群聊信息密度大且存在大量 AI 间的互动，本 Story 需 design 专门的过滤与提取机制，确保系统仅将与"人类用户"相关的关键信息沉淀到长期记忆中，维持用户画像的准确性。

## 用户故事

### US-1: 有效信息沉淀
**作为** 系统，
**我希望** 能通过独立的提取提示词（Prompt）处理群聊历史，
**以便** 准确捕捉用户在群聊中流露出的个人偏好或生活事件，忽略 Agent 间的社交辞令。

### US-2: 画像持续更新
**作为** 用户，
**我希望** 我在群里提到的事情（例如"我最近在练吉他"），之后在单聊或新群聊中也能被 AI 友人们记得，
**以便** 获得跨场景的一致性体验。

## 功能范围

### 包含
- **群聊专用提取 Prompt**: 在 `server/app/prompt/memory/` 下创建 `group_memory_extraction.txt`。
- **消息流预处理**: 归档前对群消息进行标注，重点突出 User 消息，协助 LLM 识别信息来源。
- **定时归档触发器**: 复用现有的被动归档机制，支持对 Group 进行 30 分钟闲置后的自动归档。
- **记忆双轨写入**: 提取出的信息主要流向用户的 Global Profile，辅助更新用户画像。

### 不包含（后续迭代）
- Agent 相互之间的记忆建立（Agent A 对 Agent B 的印象）
- 复杂的群组共性记忆提取（如群组话题趋势分析）

## 验收标准

- [ ] AC-1: 完成并验证 `group_memory_extraction.txt` 提示词，能够从多人对话中精准识别用户信息。
- [ ] AC-2: 群聊会话在满足时间条件后能成功进入归档流程，并标记为已提取。
- [ ] AC-3: 系统处理日志显示，AI 生成的社交捧哏话语被成功过滤。
- [ ] AC-4: 验证提取出的记忆可以在用户个人资料卡片或后续的单聊中被成功召回。
- [ ] AC-5: 在并发提取大量群消息时，系统资源占用处于合理范围内，不影响主服务性能。

## 依赖关系

### 前置依赖
- Story 09-01: 群聊数据建模
- Story 09-05: 群聊消息服务接口
- Epic-01 中的双轨记忆基础设施

### 被依赖（后续）
- 无
