# Story 09-08: 隐藏的群管理员 Agent (Hidden Admin)

> Epic: AI 多人群聊 (Group Chat)
> Priority: High
> Points: 8

## 概述
实现群聊的"调度大脑"。引入一个不可见的管理员 Agent，负责在用户发言后进行意图与角色相关性评估，自动挑选最合适的 AI 好友参与对话，维持群聊的秩序和趣味性。

## 用户故事

### US-1: 自动角色分配
**作为** 用户，
**我希望** 在群里抛出一个特定话题（如"谁了解 Python？"）后，对应的专长 AI 能主动接话，
**以便** 获得像与真人社交一样的即时反应。

### US-2: 避免复读干扰
**作为** 系统，
**我希望** 在非必要时限制发言人数（如通常只让 1-2 人回答），
**以便** 防止消息爆炸和资源浪费。

## 功能范围

### 包含
- **Manager Prompt 管理**: 在 `server/app/prompt/chat/` 下创建管理决策提示词，包含群成员特征说明和决策规则。
- **分发决策器**: 后端拦截用户群聊消息，先调用轻量级模型（或同一模型）生成发言者清单。
- **调度执行引擎**: 解析清单并异步拉起后续的 Agent 任务。
- **优先级冲突处理**: 显式 @ 的角色必定被调度，Manager 只负责在此基础上查漏补缺。
- **决策阈值控制**: 通过配置限制单词最大调度人数（如单次最多 3 名 Agent）。

### 不包含（后续迭代）
- Agent 之间的主动"抢话"逻辑（目前仍由用户消息驱动）
- 管理员显式参与群管理（如禁言模仿、踢人等）

## 验收标准

- [ ] AC-1: 当用户在群内发起通用型话题时，后端能自动返回至少一个发言者。
- [ ] AC-2: 在 `auto_reply` 关闭的情况下，Manager 不会进行任何工作（保持沉默）。
- [ ] AC-3: 实现 Manager 的 ID 决策与 Story 09-04 的 @ 列表合并算法。
- [ ] AC-4: 确保 Manager 决策过程不会增加过多的响应延迟（采用 Fast/Small Model 进行决策）。
- [ ] AC-5: 日志能够清晰记录 Manager 的决策依据（Thought 过程）。
- [ ] AC-6: 容错处理：若 Manager 接口超时（如 5s）或报错，自动按 Fallback 策略挑选 1 名活跃 Agent 回复，确保流程不断层。

## 依赖关系

### 前置依赖
- Story 09-04: @提及功能与强制触发
- Story 09-06: 群聊上下文适配
- Story 09-07: GroupChatArea 并行渲染

### 被依赖（后续）
- Story 09-09: 自动回复逻辑门控
