# Story 06-01: 默认招呼消息

> Epic: 好友列表与聊天标题优化
> Priority: High
> Points: 5

## 概述

实现好友初始消息自动创建功能。当从好友库添加好友或初始化预设好友时，系统自动使用好友模板的 `initial_message` 字段创建第一条聊天记录，确保好友列表始终有消息可展示，提升用户体验的完整性。

## 用户故事

### US-1: 从好友库添加好友
**作为** 用户，
**我希望** 从好友库添加好友时，系统自动发送一条好友的招呼消息，
**以便** 我立即能看到与该好友的对话内容，无需手动开始对话。

### US-2: 预设好友初始化
**作为** 新用户，
**我希望** 首次使用应用时，预设好友已经有默认的招呼消息，
**以便** 我的好友列表不会显示空白，可以直观了解每个好友的特点。

## 功能范围

### 包含
- 后端：从好友库添加好友时，读取模板的 `initial_message` 并创建一条 assistant 角色的消息
- 后端：数据库初始化时，为预设好友创建默认招呼消息记录
- 后端：新增 API 或修改现有 API 以支持添加好友时自动创建初始消息
- 消息存储：创建对应的 `chat_session` 和 `message` 记录

### 不包含（后续迭代）
- 好友创建/编辑对话框的招呼消息编辑功能
- 招呼消息的多语言支持
- 招呼消息的AI生成功能

## 验收标准

- [ ] AC-1: 从好友库添加好友后，该好友自动关联一条 `role=assistant` 的初始消息
- [ ] AC-2: 初始消息内容来源于好友模板的 `initial_message` 字段
- [ ] AC-3: 若模板的 `initial_message` 为空，则使用通用默认招呼语（如 "你好！"）
- [ ] AC-4: 数据库初始化后，预设好友均有对应的初始消息记录
- [ ] AC-5: 新创建的消息自动关联到一个新的 `chat_session`

## 依赖关系

### 前置依赖
- Epic-01: 基础聊天功能和好友管理（已完成）
- 好友库功能已实现（`friend_templates` 表和相关 API）

### 被依赖（后续）
- Story 06-02: 好友列表显示最近消息（依赖初始消息存在）

## 备注

- 好友库即 `friend_templates` 表，其中每个模板都有 `initial_message` 字段
- 需注意数据库迁移脚本的幂等性，避免重复创建预设好友的初始消息
- 初始消息应该有合理的时间戳，建议使用好友创建时间
